SSL

TLS - Transport Lyear Security

Интерфейс который использует socket security

TLS - рукопажание - это процедура в которой про

процесс - функция от времени


## [CA]Создайте сертификат CA  с CN = CA-LAB22-XYZ.

CA - центр сертификации
CN  -  это часть информации в сертификате, которая указывает его идентификатор. Это имя обычно отображается в деталях сертификата, когда он используется.

За генерацию сертификата и центра сертификации отвечает файл generateCertificates.

``` bash
node ./src/certification_authority/generateCertificate.js 
```

#### Код генерации

```js
runCommand(`openssl genrsa -out ${caKeyPath} 2048`);  
```

Эта команда генерирует приватный ключ для центра сертификации (CA). 

- **`openssl`**: Утилита OpenSSL для работы с криптографией.
- **`genrsa`**: Указывает, что необходимо сгенерировать приватный ключ RSA (асимметричный).
- **`-out ${caKeyPath}`**: Указывает файл, куда будет сохранен сгенерированный приватный ключ. Переменная `${caKeyPath}` содержит путь, например, `./certificates/ca.key`.
- **`2048`**: Длина ключа в битах. Рекомендуемые значения — 2048 или 4096 для обеспечения безопасности.

```js
runCommand(`openssl req -x509 -new -nodes -key ${caKeyPath} -sha256 -days 365 -out ${caCertPath} -subj "/CN=CA-LAB22-SAA"`);
```

Эта команда создает самоподписанный сертификат для CA.
- **`openssl`**: Утилита OpenSSL для работы с криптографией.
- **`req`**: Указывает, что создается запрос на сертификат или сам сертификат.
- **`-x509`**: Указывает, что создается самоподписанный сертификат (формат X.509). Это используется для создания корневого (root) сертификата.
- **`-new`**: Указывает, что создается новый сертификат.
- **`-nodes`**: Указывает, что приватный ключ не должен быть зашифрован паролем. Если убрать этот параметр, OpenSSL запросит пароль при использовании ключа.
- **`-key ${caKeyPath}`**: Указывает путь к приватному ключу CA, который будет использоваться для подписи сертификата. Здесь используется ключ, созданный на первом шаге.
- **`-sha256`**: Указывает алгоритм хэширования для подписи сертификата. SHA-256 является стандартом и обеспечивает высокий уровень безопасности.
- **`-days 365`**: Указывает срок действия сертификата в днях. В данном случае сертификат будет действителен 1 год.
- **`-out ${caCertPath}`**: Указывает файл, куда будет сохранен сгенерированный сертификат. Переменная `${caCertPath}` содержит путь, например, `./certificates/ca.crt`.
- **`-subj "/CN=CA-LAB22-SAA"`**: Указывает информацию о субъекте сертификата.
    - **`/CN=CA-LAB22-SAA`** означает, что Common Name (CN) сертификата будет `CA-LAB22-SAA`. Это имя будет использоваться для идентификации CA.

## [RESOURCE] Сгенерируйте запрос на сертификат к CA с CN = RS-LAB22- ABC и передайте его  CA для генерации сертификата.

За генерацию запроса на сертификат отвечает файл generateCSR.js.

```bash
node ./src/resource/generateCSR.js
```

#### Код генерации

```js
runCommand(`openssl genrsa -out ${privateKeyPath} 2048`);
```

Генерирует приватный ключ RSA длиной 2048 бит

```js
runCommand(`openssl req -new -key ${privateKeyPath} -out ${csrPath} -subj "/CN=RS-LAB22-RSA"`);
```

### Разбор параметров:

1. **`openssl`**:
    
    - Утилита OpenSSL для выполнения криптографических операций, таких как генерация ключей, сертификатов и запросов на сертификаты.
2. **`req`**:
    
    - Указывает, что используется команда для работы с сертификатами, в частности для создания **запроса на подпись сертификата** (CSR — Certificate Signing Request).
3. **`-new`**:
    
    - Указывает, что необходимо создать новый CSR.
4. **`-key ${privateKeyPath}`**:
    
    - Указывает путь к приватному ключу, который будет использован для создания CSR.
    - Переменная `${privateKeyPath}` заменяется на фактический путь к приватному ключу, например `./certificates/resource.key`.
5. **`-out ${csrPath}`**:
    
    - Указывает путь, куда будет сохранен сгенерированный CSR.
    - Переменная `${csrPath}` заменяется на путь, например `./certificates/resource.csr`.
6. **`-subj "/CN=RS-LAB22-RSA"`**:
    
    - Указывает информацию о субъекте (владельце) сертификата. Эта информация будет включена в CSR.
    - **`/CN=RS-LAB22-RSA`**:
        - **`CN` (Common Name):** Указывает общее имя сертификата. В данном случае это `RS-LAB22-RSA`.
        - Обычно это имя или домен, для которого создается сертификат.

---

### Что делает команда:

1. **Создает CSR (Certificate Signing Request):**
    
    - CSR — это запрос на подпись сертификата, который содержит:
        - Публичный ключ (созданный на основе приватного ключа).
        - Информацию о субъекте (например, `CN=RS-LAB22-RSA`).
        - Дополнительные параметры, такие как алгоритм шифрования.
2. **Применяет приватный ключ:**
    
    - Приватный ключ (`${privateKeyPath}`) используется для генерации CSR.
3. **Результат:**
    
    - На выходе создается файл CSR (`${csrPath}`), который затем передается центру сертификации (CA) для подписи.

---

### Назначение CSR:

CSR передается центру сертификации (CA), который подписывает его и выдает готовый сертификат. Этот сертификат будет использоваться для шифрования и аутентификации (например, для HTTPS).

##  [Resource] Получите от СА два сертификата

Теперь мы должны подписать сертификаты для двух доменов LAB22-RSA и RSA

1) При создании запроса появилась папка resource_csr, её перемещаем в папку certifices в CA, а именно resource.csr и resoucre.key
2) Далее подписываем сертификаты

```js
node ./src/certification_authority/signCSR.js
```

Пояснение созданных файлов:

### **. `ca.srl`**

- **Назначение:**
    - Это файл серийного номера, автоматически созданный OpenSSL.
    - Он используется CA (Центром Сертификации) для отслеживания серийных номеров сертификатов, которые он выдал.
    - Каждый раз, когда CA подписывает новый сертификат, он увеличивает серийный номер, чтобы гарантировать уникальность сертификатов.
- **Расположение:** Этот файл обычно создаётся в той же директории, где хранятся CA-сертификаты и ключи.

---

### **2. `san_first.ext` и `san_second.ext`**

- **Назначение:**
    - Это файлы расширений, которые используются для добавления атрибута **SAN (Subject Alternative Name)** при создании сертификатов.
    - SAN позволяет указать дополнительные имена (домены) для сертификата. Это важно для современных браузеров и серверов, так как они требуют SAN для проверки сертификатов.
- **Содержимое:**
    - **`san_first.ext`:** Указывает, что сертификат `resource_first.crt` предназначен для домена `LAB22-RSA`.
        
        Code
        
        ```
        subjectAltName = DNS:LAB22-RSA
        ```
        
    - **`san_second.ext`:** Указывает, что сертификат `resource_second.crt` предназначен для домена `RSA`.
        
        Code
        
        ```
        subjectAltName = DNS:RSA
        ```
        

---

### **3. `resource_csr/resource_first.crt`**

- **Назначение:**
    - Это подписанный сертификат для домена `LAB22-RSA`.
    - Он был создан с использованием одного общего запроса на сертификат (`resource.csr`) и расширения из `san_first.ext`.
    - Этот сертификат используется для обеспечения безопасного соединения HTTPS для домена `LAB22-RSA`.

---

### **4. `resource_csr/resource_second.crt`**

- **Назначение:**
    - Это подписанный сертификат для домена `RSA`.
    - Как и `resource_first.crt`, он был создан на основе общего запроса на сертификат (`resource.csr`) и расширения из `san_second.ext`.
    - Этот сертификат используется для обеспечения безопасного соединения HTTPS для домена `RSA`.

---

### Как это работает в целом:

1. **Центр Сертификации (CA):**
    
    - Использует свой корневой сертификат (`ca.crt`) и приватный ключ (`ca.key`) для подписания запросов на сертификаты (CSR).
2. **Запрос на сертификат (CSR):**
    
    - Один запрос (`resource.csr`) создаётся с общим именем `Resource` и приватным ключом `resource.key`.
3. **Расширения SAN:**
    
    - Файлы `san_first.ext` и `san_second.ext` добавляют специфичные домены (`LAB22-RSA` и `RSA`) в сертификаты.
4. **Выданные сертификаты:**
    
    - `resource_first.crt` и `resource_second.crt` — это два разных сертификата, подписанных CA, каждый из которых привязан к своему домену.


## [RESOURCE] Получите от СА два сертификата + [CA] Передайте **Resource** сгенерированный сертификат и свой CA- сертификат.

Перемещаем файлы из папки /certification_authority/certificates/resource_csr в папку certificates (если нет, то создаём), а также файл ca.crt

Получено :)


## [RESOURCE]  Импортируйте СА-сертификат в хранилище сертификатов (доверенные центры сертификации).

Переместите ваш CA-сертификат (например, `ca.crt`) в директорию `/usr/local/share/ca-certificates/`. Для этого используйте следующую команду:

```bash
sudo cp ./src/resource/ca.crt /usr/local/share/ca-certificates/
```

Обновляем хранилище сертификатов:

```bash
sudo update-ca-certificates
````


Проверка

```bash
ls -l /etc/ssl/certs | grep ca.crt
```

```
lrwxrwxrwx 1 root root     39 May  7 00:11 ca.pem -> /usr/local/share/ca-certificates/ca.crt
```


## [RESOURCE] Разработайте приложение **22-01**, которое принимает GET-запросы по https-протоколу. Тестирование выполните с помощью браузера.


